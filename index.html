<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REPORTE EJECUTIVO TULANCINGO 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@900&family=JetBrains+Mono:wght@400;800&display=swap" rel="stylesheet">
    <style>
        :root { --primario: #001529; --acento: #facc15; }
        body { background: radial-gradient(circle at top, #002d54 0%, #001529 100%); font-family: 'JetBrains Mono', monospace; color: white; }
        .font-orbitron { font-family: 'Orbitron', sans-serif; }
        
        .tarjeta-3d {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transform: perspective(1000px) rotateX(2deg);
            transition: all 0.4s ease;
        }
        .tarjeta-3d:hover {
            transform: perspective(1000px) rotateX(0deg) translateY(-5px);
            border-color: var(--acento);
            background: rgba(255, 255, 255, 0.08);
        }
        .texto-brillo { text-shadow: 0 0 15px var(--acento); }
        .ranking-item:nth-child(1) { color: #facc15; font-size: 1.1rem; font-weight: 800; }
        
        @keyframes aparecer {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animar { animation: aparecer 0.6s ease backwards; }
    </style>
</head>
<body class="p-4 md:p-10">

    <header class="text-center mb-12 animar">
        <h1 class="font-orbitron text-4xl md:text-6xl italic texto-brillo mb-2 uppercase">RESULTADOS 2025</h1>
        <p class="text-yellow-400 tracking-[0.4em] text-[10px] font-bold uppercase">Llanterama Tulancingo • Dashboard de Junta</p>
    </header>

    <div id="pantalla-carga" class="flex flex-col items-center justify-center py-20">
        <i class="fas fa-sync-alt animate-spin text-4xl text-yellow-400 mb-4"></i>
        <p class="text-xs uppercase tracking-widest opacity-50">Procesando rankings y métricas...</p>
    </div>

    <div id="contenedor-principal" class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 hidden">
        </div>

    <script>
        const URL_DATOS = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRA2Ijt1TI5_APzSJNjdlGF1_Jex0-n3iTiy8R996VR6PNx6V7tM8xO8u3sFKwp2A/pub?gid=1217270027&single=true&output=csv';

        async function iniciar() {
            try {
                const res = await fetch(URL_DATOS + '&t=' + Date.now());
                const texto = await res.text();
                Papa.parse(texto, { header: true, complete: (res) => {
                    const datos = res.data.filter(r => r.AÑO == "2025");
                    procesarDatos(datos);
                }});
            } catch (e) { alert("Error al cargar base de datos"); }
        }

        function procesarDatos(datos) {
            const n = (v) => parseFloat(String(v || "0").replace(/[^0-9.-]+/g,"")) || 0;
            const f = (v) => Math.round(v).toLocaleString('es-MX');

            // --- LÓGICA DE RANKINGS ---
            const agrupar = (campo, valor) => {
                const obj = {};
                datos.forEach(r => obj[r[campo]] = (obj[r[campo]] || 0) + n(r[valor]));
                return Object.entries(obj).sort((a,b) => b[1] - a[1]);
            };

            const topVendedores = agrupar('VENDEDOR', 'IMPORTE NETO').slice(0, 3);
            const topZonas = agrupar('ZONA', 'IMPORTE NETO').slice(0, 3);
            const topMeses = agrupar('MES', 'IMPORTE NETO').slice(0, 3);

            // --- LÓGICA DE CATEGORÍAS ---
            const sumaCat = (col) => datos.reduce((acc, r) => acc + n(r[col]), 0);

            const html = `
                <div class="tarjeta-3d p-8 rounded-[2rem] border-b-4 border-yellow-400 animar">
                    <p class="text-[10px] font-bold text-yellow-400 uppercase mb-2 tracking-widest">Facturación Total 2025</p>
                    <h2 class="text-5xl font-black italic texto-brillo">$${f(sumaCat('IMPORTE NETO'))}</h2>
                    <p class="text-[9px] mt-4 opacity-40 uppercase font-bold">Consolidado General Tulancingo</p>
                </div>

                <div class="tarjeta-3d p-8 rounded-[2rem] animar" style="animation-delay: 0.1s">
                    <div class="flex items-center gap-3 mb-6">
                        <i class="fas fa-trophy text-yellow-400 text-2xl"></i>
                        <h3 class="font-black uppercase italic tracking-tighter">Top 3 Vendedores</h3>
                    </div>
                    <div class="space-y-4">
                        ${topVendedores.map((v, i) => `
                            <div class="flex justify-between items-center border-b border-white/5 pb-2">
                                <span class="text-xs uppercase font-bold">${i+1}. ${v[0]}</span>
                                <span class="text-yellow-400 font-black">$${f(v[1])}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div class="tarjeta-3d p-8 rounded-[2rem] animar" style="animation-delay: 0.2s">
                    <div class="flex items-center gap-3 mb-6">
                        <i class="fas fa-map-marked-alt text-blue-400 text-2xl"></i>
                        <h3 class="font-black uppercase italic tracking-tighter">Top 3 Zonas</h3>
                    </div>
                    <div class="space-y-4">
                        ${topZonas.map((z, i) => `
                            <div class="flex justify-between items-center border-b border-white/5 pb-2">
                                <span class="text-xs uppercase font-bold">${i+1}. ${z[0]}</span>
                                <span class="text-blue-400 font-black">$${f(z[1])}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div class="col-span-1 md:col-span-2 lg:col-span-3 grid grid-cols-2 lg:grid-cols-4 gap-4 animar" style="animation-delay: 0.3s">
                    <div class="tarjeta-3d p-6 rounded-3xl text-center">
                        <i class="fas fa-car-battery text-yellow-400 mb-2"></i>
                        <p class="text-[9px] uppercase font-bold opacity-50">Acumuladores</p>
                        <p class="text-3xl font-black italic">${f(sumaCat('REAL ACUMULADORES'))}</p>
                    </div>
                    <div class="tarjeta-3d p-6 rounded-3xl text-center">
                        <i class="fas fa-oil-can text-orange-400 mb-2"></i>
                        <p class="text-[9px] uppercase font-bold opacity-50">Lubricantes</p>
                        <p class="text-3xl font-black italic">${f(sumaCat('REAL LUBRICANTES'))}</p>
                    </div>
                    <div class="tarjeta-3d p-6 rounded-3xl text-center">
                        <i class="fas fa-motorcycle text-red-400 mb-2"></i>
                        <p class="text-[9px] uppercase font-bold opacity-50">Motobaterías</p>
                        <p class="text-3xl font-black italic">${f(sumaCat('REAL MOTOBATERIAS'))}</p>
                    </div>
                    <div class="tarjeta-3d p-6 rounded-3xl text-center">
                        <i class="fas fa-filter text-green-400 mb-2"></i>
                        <p class="text-[9px] uppercase font-bold opacity-50">Filtros</p>
                        <p class="text-3xl font-black italic">${f(sumaCat('REAL FILTROS'))}</p>
                    </div>
                </div>

                <div class="tarjeta-3d p-8 rounded-[2rem] animar" style="animation-delay: 0.4s">
                    <div class="flex items-center gap-3 mb-6">
                        <i class="fas fa-calendar-alt text-purple-400 text-2xl"></i>
                        <h3 class="font-black uppercase italic tracking-tighter">Meses de Impacto</h3>
                    </div>
                    <div class="space-y-4">
                        ${topMeses.map((m, i) => `
                            <div class="flex justify-between items-center border-b border-white/5 pb-2">
                                <span class="text-xs uppercase font-bold">${m[0]}</span>
                                <div class="bg-purple-500/20 px-3 py-1 rounded-lg text-purple-300 text-[10px] font-black italic">RANKING #${i+1}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div class="tarjeta-3d p-8 rounded-[2rem] bg-yellow-400 !text-blue-950 flex items-center justify-center text-center lg:col-span-2 animar" style="animation-delay: 0.5s">
                    <h4 class="text-2xl font-black uppercase italic leading-tight italic">"El éxito de 2025 es el resultado de la disciplina operativa y el enfoque en objetivos clave."</h4>
                </div>
            `;

            document.getElementById('pantalla-carga').classList.add('hidden');
            const cont = document.getElementById('contenedor-principal');
            cont.innerHTML = html;
            cont.classList.remove('hidden');
        }

        iniciar();
    </script>
</body>
</html>
