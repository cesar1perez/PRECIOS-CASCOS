<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COMPARATIVA ESTRATÉGICA 2024-2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #0f172a; --accent: #2563eb; --danger: #dc2626; --success: #16a34a; }
        body { background-color: #f8fafc; font-family: 'Inter', sans-serif; color: #1e293b; }
        .glass-card { 
            background: white; 
            border: 1px solid #e2e8f0; 
            border-radius: 1rem; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s ease;
        }
        .glass-card:hover { transform: translateY(-3px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .vs-badge { padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: 800; }
        .positive { background: #dcfce7; color: #166534; }
        .negative { background: #fee2e2; color: #991b1b; }
        .chart-bar { height: 8px; border-radius: 4px; background: #e2e8f0; overflow: hidden; position: relative; }
        .chart-fill { height: 100%; position: absolute; left: 0; top: 0; }
    </style>
</head>
<body class="p-6">

    <header class="max-w-7xl mx-auto mb-10 flex flex-col md:flex-row justify-between items-center border-b pb-6">
        <div>
            <h1 class="text-3xl font-extrabold text-slate-900 tracking-tight">ANÁLISIS COMPARATIVO <span class="text-blue-600">2024 VS 2025</span></h1>
            <p class="text-slate-500 font-medium">Llanterama Tulancingo • Equipo Comercial de Mayoreo</p>
        </div>
        <div class="mt-4 md:mt-0 flex gap-4 text-[10px] font-bold uppercase tracking-widest text-slate-400">
            <span>Confidencial</span>
            <span class="text-blue-600">● Actualizado 2026</span>
        </div>
    </header>

    <div id="main-content" class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-6">
        </div>

    <script>
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRA2Ijt1TI5_APzSJNjdlGF1_Jex0-n3iTiy8R996VR6PNx6V7tM8xO8u3sFKwp2A/pub?gid=1217270027&single=true&output=csv';
        const TARGET_SELLERS = ["ONESIMO", "MIGUEL", "RUBEN", "CS RIO MAYOREO", "CS MAYOREO", "TIZAYUCA (CELENE)", "CS CD SAHAGUN MAYOREO"];

        async function init() {
            const res = await fetch(CSV_URL + '&t=' + Date.now());
            const text = await res.text();
            Papa.parse(text, { header: true, complete: (res) => {
                const filtered = res.data.filter(r => TARGET_SELLERS.includes(r.VENDEDOR?.toUpperCase().trim()));
                render(filtered);
            }});
        }

        function render(data) {
            const n = (v) => parseFloat(String(v || "0").replace(/[^0-9.-]+/g,"")) || 0;
            const f = (v) => Math.round(v).toLocaleString('es-MX');

            const group = (year, field) => {
                const res = {};
                data.filter(r => r.AÑO == year).forEach(r => {
                    const month = r.MES?.toUpperCase();
                    res[month] = (res[month] || 0) + n(r[field]);
                });
                return res;
            };

            const months = ["ENERO", "FEBRERO", "MARZO", "ABRIL", "MAYO", "JUNIO", "JULIO", "AGOSTO", "SEPTIEMBRE", "OCTUBRE", "NOVIEMBRE", "DICIEMBRE"];
            const sales24 = group("2024", "IMPORTE NETO");
            const sales25 = group("2025", "IMPORTE NETO");

            // Totales por producto
            const prodSum = (year, field) => data.filter(r => r.AÑO == year).reduce((acc, r) => acc + n(r[field]), 0);
            
            let html = `
                <div class="lg:col-span-8 space-y-6">
                    <div class="glass-card p-6">
                        <h3 class="font-bold text-slate-800 mb-6 flex items-center gap-2 italic uppercase text-sm">
                            <i class="fas fa-columns text-blue-600"></i> Comparativa Mensual de Ventas
                        </h3>
                        <div class="space-y-4">
                            ${months.map(m => {
                                const v24 = sales24[m] || 0;
                                const v25 = sales25[m] || 0;
                                if(v24 === 0 && v25 === 0) return '';
                                const diff = v24 === 0 ? 100 : ((v25 - v24) / v24) * 100;
                                const isPos = diff >= 0;
                                return `
                                    <div class="grid grid-cols-12 items-center gap-4 border-b border-slate-50 pb-2">
                                        <div class="col-span-2 text-[10px] font-extrabold text-slate-500">${m}</div>
                                        <div class="col-span-8">
                                            <div class="flex justify-between text-[10px] mb-1">
                                                <span class="text-slate-400">2024: $${f(v24)}</span>
                                                <span class="font-bold text-blue-600">2025: $${f(v25)}</span>
                                            </div>
                                            <div class="chart-bar">
                                                <div class="chart-fill bg-slate-200" style="width: 100%"></div>
                                                <div class="chart-fill bg-blue-500" style="width: ${Math.min(100, (v25/v24)*100)}%"></div>
                                            </div>
                                        </div>
                                        <div class="col-span-2 text-right">
                                            <span class="vs-badge ${isPos ? 'positive' : 'negative'}">
                                                ${isPos ? '▲' : '▼'} ${Math.abs(Math.round(diff))}%
                                            </span>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        ${[
                            {label: 'Acumuladores', col: 'REAL ACUMULADORES', icon: 'fa-car-battery'},
                            {label: 'Lubricantes', col: 'REAL LUBRICANTES', icon: 'fa-oil-can'},
                            {label: 'Filtros', col: 'REAL FILTROS', icon: 'fa-filter'},
                            {label: 'Motobaterías', col: 'REAL MOTOBATERIAS', icon: 'fa-motorcycle'}
                        ].map(p => {
                            const p24 = prodSum("2024", p.col);
                            const p25 = prodSum("2025", p.col);
                            const diff = p24 === 0 ? 0 : Math.round(((p25-p24)/p24)*100);
                            return `
                                <div class="glass-card p-5">
                                    <div class="flex justify-between items-start mb-4">
                                        <div class="w-10 h-10 bg-slate-100 rounded-lg flex items-center justify-center text-slate-600">
                                            <i class="fas ${p.icon}"></i>
                                        </div>
                                        <span class="text-xs font-bold ${diff >= 0 ? 'text-green-600' : 'text-red-600'}">${diff >= 0 ? '+' : ''}${diff}%</span>
                                    </div>
                                    <h4 class="text-xs font-bold text-slate-400 uppercase mb-1">${p.label}</h4>
                                    <div class="flex justify-between items-end">
                                        <span class="text-xs text-slate-400 italic">2024: ${p24} pz</span>
                                        <span class="text-xl font-black text-slate-800">${p25} <small class="text-[10px]">PZ</small></span>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>

                <div class="lg:col-span-4 space-y-6">
                    <div class="glass-card p-6 border-l-4 border-red-500">
                        <h3 class="text-red-600 font-bold text-xs uppercase tracking-tighter mb-4 flex items-center gap-2">
                            <i class="fas fa-exclamation-circle"></i> Focos de Atención Críticos
                        </h3>
                        <ul class="space-y-4 text-[11px] text-slate-600">
                            <li>
                                <b class="text-slate-900 block mb-1 uppercase">Déficit en Líneas de Volumen:</b>
                                La comparativa muestra que en categorías como <b>Filtros</b>, el equipo no ha logrado superar los picos de 2024. Hay un estancamiento operativo.
                            </li>
                            <li>
                                <b class="text-slate-900 block mb-1 uppercase">Zonas Vulnerables:</b>
                                El despliegue de <b>Sahagún y Tizayuca</b> está siendo superado por la inercia de 2024; no se ve un crecimiento agresivo proyectado para el cierre de 2025.
                            </li>
                            <li>
                                <b class="text-slate-900 block mb-1 uppercase">Alerta en Meses de "Bache":</b>
                                Los meses con porcentaje negativo (▼) son puntos donde la competencia ganó terreno o hubo falta de stock.
                            </li>
                        </ul>
                    </div>

                    <div class="glass-card p-6 bg-slate-900 text-white">
                        <h3 class="text-blue-400 font-bold text-[10px] uppercase mb-4 tracking-widest">Conclusión de Estrategia</h3>
                        <p class="text-xs leading-relaxed opacity-90 italic">
                            "Tulancingo presenta un comportamiento cíclico. El versus contra 2024 revela que estamos creciendo en facturación neta, pero perdiendo tracción en <b>unidades reales</b> en lubricantes. La junta debe decidir si el enfoque será volumen o margen de utilidad para el siguiente trimestre."
                        </p>
                    </div>
                </div>
            `;
            document.getElementById('main-content').innerHTML = html;
        }
        init();
    </script>
</body>
</html>
